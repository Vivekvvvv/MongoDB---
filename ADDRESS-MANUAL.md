# 地址管理功能使用说明

## 功能概述

本电商平台现在具备完整的地址管理功能，用户可以：

- ✅ 新增收货地址
- ✅ 编辑现有地址
- ✅ 设置默认地址
- ✅ 删除地址
- ✅ 地址标签分类（家、公司、学校、其他）
- ✅ 地址自动排序

## 技术实现

### 后端实现

1. **数据模型** (`models/Address.js`)
   - 包含完整的地址字段：姓名、电话、省市区、详细地址、邮编等
   - 支持默认地址设置
   - 支持地址标签分类
   - 支持地址排序字段

2. **API端点** (`server.js`)
   - `GET /api/addresses` - 获取用户地址列表
   - `POST /api/addresses` - 创建新地址
   - `PUT /api/addresses/:id` - 更新地址
   - `DELETE /api/addresses/:id` - 删除地址

### 前端实现

1. **地址管理页面** (`public/address.html`)
   - 响应式设计，支持移动端
   - 地址卡片展示
   - 模态框编辑表单
   - 实时验证和错误处理

2. **用户交互**
   - 从首页用户菜单进入地址管理
   - 支持新增、编辑、删除操作
   - 默认地址设置
   - 地址标签管理

## 使用方法

### 1. 访问地址管理

1. 登录平台后，点击右上角用户名
2. 在下拉菜单中选择"地址管理"
3. 或者直接访问 `http://localhost:3000/address.html`

### 2. 添加新地址

1. 在地址管理页面点击"新增地址"按钮
2. 填写地址信息：
   - 收货人姓名（必填）
   - 手机号码（必填，11位数字）
   - 地址标签（家/公司/学校/其他）
   - 省市区（必填）
   - 详细地址（必填）
   - 邮政编码（可选）
   - 是否设为默认地址
3. 点击"保存"按钮

### 3. 编辑地址

1. 在地址卡片上点击"编辑"按钮
2. 修改需要更改的信息
3. 点击"保存"按钮

### 4. 设置默认地址

1. 在地址卡片上点击"设为默认"按钮
2. 系统会自动取消其他地址的默认状态
3. 默认地址会有特殊标识

### 5. 删除地址

1. 在地址卡片上点击"删除"按钮
2. 确认删除操作
3. 地址将从列表中移除

## 数据存储

地址信息存储在MongoDB的`addresses`集合中，包含以下字段：

```javascript
{
  userId: ObjectId,        // 用户ID
  name: String,            // 收货人姓名
  phone: String,           // 手机号码
  province: String,        // 省份
  city: String,            // 城市
  district: String,        // 区县
  detail: String,          // 详细地址
  postalCode: String,      // 邮政编码
  isDefault: Boolean,      // 是否默认地址
  tag: String,            // 地址标签
  order: Number,          // 排序顺序
  createdAt: Date,        // 创建时间
  updatedAt: Date         // 更新时间
}
```

## 测试功能

### 运行测试脚本

```bash
cd 简易电商平台
node test-address.js
```

测试脚本会：
1. 创建测试地址数据
2. 测试地址的增删改查功能
3. 验证地址排序功能
4. 清理测试数据

### 手动测试

1. 启动服务器：
   ```bash
   node server.js
   ```

2. 浏览器访问：`http://localhost:3000/login.html`

3. 使用管理员账户登录：
   - 邮箱：`12345@123.com`
   - 密码：`12345`

4. 访问地址管理页面进行功能测试

## 安全考虑

1. **用户隔离**：目前API返回所有地址，生产环境需要根据当前用户筛选
2. **输入验证**：前端进行基本验证，后端应该添加更严格的验证
3. **权限控制**：需要添加用户认证中间件，确保用户只能管理自己的地址

## 扩展功能建议

1. **地址导入**：支持从其他平台导入地址
2. **地址验证**：集成第三方地址验证API
3. **快速选择**：支持常用地址快速选择
4. **地址复制**：支持复制现有地址创建新地址
5. **批量管理**：支持批量操作地址

## 故障排除

### 常见问题

1. **地址保存失败**
   - 检查所有必填字段是否填写
   - 确认手机号码格式正确（11位数字）

2. **页面加载失败**
   - 确认服务器正在运行
   - 检查数据库连接状态

3. **地址不显示**
   - 检查浏览器控制台错误信息
   - 确认API端点响应正常

### 调试方法

1. 打开浏览器开发者工具（F12）
2. 查看Network标签页的API请求
3. 查看Console标签页的错误信息
4. 检查服务器日志输出

## 更新日志

- **v1.0** (2024-11-24): 初始版本，支持完整的地址管理功能
  - 新增地址管理页面
  - 实现地址的增删改查
  - 支持默认地址和标签分类
  - 响应式设计支持移动端